# Student Management Implementation Guide

This document outlines the implementation of the Student Management features, including Active/Inactive status toggling, Soft Deletion, and Historical Data preservation.

## 1. Backend Changes (`main.py`)

### Soft Delete Implementation
The `delete_student` endpoint has been updated to perform a "soft delete" instead of a hard database deletion. This ensures that while the student is removed from active lists, their historical data (attendance, fees, performance) remains intact for reporting.

```python
@app.delete("/students/{student_id}")
def delete_student(student_id: int):
    """Soft delete a student (mark as deleted)"""
    # ...
    student.status = "deleted" 
    # History in batch_students, fees, attendance is PRESERVED
    # ...
```

### Student Retrieval
The `get_students` endpoint now filters out "deleted" students by default, keeping the management lists clean. Valid students (Active/Inactive) are returned.

```python
@app.get("/students/")
def get_students(include_deleted: bool = Query(False, ...)):
    # ...
    if not include_deleted:
        query = query.filter(StudentDB.status != "deleted")
    # ...
```

## 2. Frontend Changes (`Flutter_Frontend`)

### Owner Rights Only
- **Student List Screen (`students_screen.dart`)**: The popup menu with "Mark Inactive/Active" and "Delete" options is available ONLY on the Owner's screen.
- **Student Details Dialog (`student_profile_tab.dart`)**: The "Manage Batches", "Mark Active/Inactive", and "Delete Student" buttons in the profile tab are now conditionally rendered. They ONLY appear if the logged-in user is an **Owner**. Coaches can view details but cannot perform these actions.

### UI Features
- **Status Toggle**: Toggling between "Active" and "Inactive" updates the student's status immediately. Inactive students remain in the list (unless filtered) but are visually distinguished.
- **Delete Action**: The "Delete" action creates a soft delete. The student will disappear from the main list but their data persists in the backend for reports.

## 3. Data Seeding & History

### Seeding Script (`seed_full_data.py`)
A comprehensive seeding script was executed to populate:
- **Historical Data**: Sessions back to Winter 2025.
- **Current Data**: Active sessions for 2026.
- **Status Variety**: A mix of Active (85%), Inactive (10%), and Deleted (5%) students to test the system.

### Reporting
Reports (Attendance, Fees) are generated by querying the respective historical tables (`attendance`, `fees`) directly. This ensures that even if a student is "deleted" today, their attendance record from 2024 is still included in the 2024 reports.

## 4. Verification

1.  **Login as Owner** (`owner@example.com` / `password123`):
    *   Go to "Students".
    *   Click the 3-dots menu on a student -> "Mark Inactive"/"Delete" works.
    *   Click a student row -> Profile tab -> Scroll down -> Management buttons are visible.
2.  **Login as Coach** (`coach1@example.com` / `password123`):
    *   Go to "My Students".
    *   Click a student row -> Profile tab -> Management buttons are **HIDDEN**.
3.  **Reports**:
    *   Generating a report for a past batch will include data for students who might be currently inactive or deleted, preserving historical accuracy.
