<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Attendance - Owner</title>
    <link rel="stylesheet" href="owner-styles.css">
</head>
<body>
    <div class="container">
        <div class="nav">
            <a href="owner-dashboard.html" >ğŸ“Š Dashboard</a>
            <a href="owner.html" >ğŸ‘¨â€ğŸ« Coaches</a>
            <a href="owner-batches.html" >ğŸ“š Batches</a>
            <a href="owner-students.html" >ğŸ“ Students</a>
            <a href="owner-attendance.html" >ğŸ“‹ Attendance</a>
            <a href="owner-coach-attendance.html" class="active">ğŸ‘” Coach Attendance</a>
            <a href="owner-fees.html" >ğŸ’° Fees</a>
            <a href="owner-performance.html" >â­ Performance</a>
            <a href="owner-bmi.html" >ğŸ“ BMI</a>
            <a href="owner-schedule.html" >ğŸ“… Schedule</a>
            <a href="owner-enquiries.html" >ğŸ“ Enquiries</a>
            <a href="owner-analytics.html" >ğŸ“ˆ Analytics</a>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        
        <h1>ğŸ‘” Coach Attendance</h1>
        
        <div class="filters">
            <div class="form-group">
                <label>From Date</label>
                <input type="date" id="fromDate">
            </div>
            <div class="form-group">
                <label>To Date</label>
                <input type="date" id="toDate">
            </div>
            <div class="form-group" style="align-items: flex-end;">
                <button class="btn" onclick="loadCoachAttendance()">Load Attendance</button>
            </div>
        </div>

        <div id="attendanceContainer"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        // Set default dates (last 30 days)
        const today = new Date();
        const thirtyDaysAgo = new Date(today);
        thirtyDaysAgo.setDate(today.getDate() - 30);
        document.getElementById('fromDate').valueAsDate = thirtyDaysAgo;
        document.getElementById('toDate').valueAsDate = today;

        loadCoachAttendance();

        async function loadCoachAttendance() {
            try {
                const fromDate = document.getElementById('fromDate').value;
                const toDate = document.getElementById('toDate').value;

                // Get all coaches
                const coachesRes = await fetch(`${API_URL}/coaches/`);
                const coaches = await coachesRes.json();

                // Get coach attendance records
                const attendanceRes = await fetch(`${API_URL}/coach-attendance/`);
                const allAttendance = await attendanceRes.json();

                // Filter by date range
                const filteredAttendance = allAttendance.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate >= new Date(fromDate) && recordDate <= new Date(toDate);
                });

                const container = document.getElementById('attendanceContainer');
                
                if (filteredAttendance.length === 0) {
                    container.innerHTML = '<div class="empty-state">No coach attendance records found for this period</div>';
                    return;
                }

                // Group by coach
                const coachMap = {};
                coaches.forEach(c => coachMap[c.id] = c.name);

                container.innerHTML = `
                    <h2>Total Records: ${filteredAttendance.length}</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Coach Name</th>
                                <th>Status</th>
                                <th>Remarks</th>
                                <th>Marked At</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredAttendance.sort((a, b) => new Date(b.date) - new Date(a.date)).map(record => `
                                <tr>
                                    <td>${formatDate(record.date)}</td>
                                    <td><strong>${coachMap[record.coach_id] || 'Unknown'}</strong></td>
                                    <td><span class="status-${record.status.toLowerCase()}">${record.status}</span></td>
                                    <td>${record.remarks || '-'}</td>
                                    <td>${formatDateTime(record.created_at)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error('Error loading coach attendance:', error);
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function logout() {
            window.location.href = 'owner.html';
        }

        setInterval(loadCoachAttendance, 30000);
    </script>
</body>
</html>